<div class="d-flex justify-content-between mt-3">
    <div class="flex-fill">
        <input type="text" class="form-control" placeholder="search...">
    </div>
    <div style="margin-left: 24px;">
        <button *ngIf="selectEnabled" class="btn btn-primary">Deleted Selected</button>
        <button (click)="selectEnabled = !selectEnabled" class="btn btn-primary">Select</button>
        <button (click)="onAddNewRow()" class="btn btn-primary">+Add Row</button>
        <button (click)="onSave()" class="btn btn-primary">Save</button>
    </div>
</div>
<div class="table-responsive mt-3">
    <table class="table table-hover">
        <thead>
            <tr  class="arc-table-header">
                <th scope="col" *ngFor="let colId of displayedColumnIds">
                    <span>{{getColumnById(colId).columnName}} </span>
                </th>
            </tr>
        </thead>
        <tbody [formGroup]="rows">
            @for (rowId of getRowsFormControls(); track $index) {
                <tr>
                    @for (colId of displayedColumnIds; track $index) {
                        <td >
                            @if(displayedColumnIds[0] === colId && selectEnabled) {
                                <span [formGroup]="getRowMetaForm(rowId)">
                                    <input formControlName="isDeleted" class="form-check-input mx-2" type="checkbox">
                                </span>
                            }
                            <span [formGroup]="getCellForm(rowId, colId)">
                                @if (cellIsEdited(rowId, colId)) {
                                    <input formControlName="value" type="datetime-local" class="form-control" *ngIf="getCell(rowId, colId).dataType === 'datetime'">
                                    @if (getCell(rowId, colId).dataType === 'string') {
                                        @if (columnIsRelationship(colId)) {
                                            <select formControlName="value" class="form-select">
                                                @for (columnData of getRelationshipColumnData(colId); track $index) {
                                                    <!-- save column id here, assign the column id to table_id on save -->
                                                    <option [value]="columnData.id">{{columnData[getColumnNameFromRelationshipColumnName(colId)]}}</option>
                                                }
                                            </select>
                                        }
                                        @else {
                                            <input formControlName="value" type="text" class="form-control">
                                        }
                                    }
                                    <input formControlName="value" type="number" class="form-control" *ngIf="getCell(rowId, colId).dataType === 'number'" appNumberOnly>
                                    <select formControlName="value" class="form-select" *ngIf="getCell(rowId, colId).dataType === 'boolean'">
                                        <option [value]="1">true</option>
                                        <option [value]="0">false</option>
                                    </select>
                                }
                                @else {
                                    @if (getCell(rowId, colId).dataType === 'datetime') {
                                        <span (dblclick)="onSelectCellForUpdate(rowId, colId)" >{{formatDate(getCell(rowId, colId).value)}}</span>
                                    }
                                    @else {
                                        <span (dblclick)="onSelectCellForUpdate(rowId, colId)" >{{getCell(rowId, colId).value}}</span>
                                    }
                                }
                            </span>
                        </td>
                    }
                </tr>
            }
        </tbody>
    </table>
</div>